---
title: 正则表达式
date: 2018-06-24 19:12:29
categories: 语言无关类
tags: 正则表达式
---
# 正则表达式概述
正则表达式，⼜称正规表示式、正规表示法、正规表达式、规则表达式、常规表示法（英语：Regular Expression，在代码中常简写为regex、regexp或RE），是计算机科学的⼀个概念。正则表达式使⽤单个字符串来描述、匹配⼀系列匹配某个句法规则的字符串。在很多⽂本编辑器⾥，正则表达式通常被⽤来检索、替换那些匹配某个模式的⽂本。Regular Expression的“Regular”⼀般被译为“正则”、“正规”、“常规”。此处的“Regular”即是“规则”、“规律”的意思，Regular Expression即“描述某种规则的表达式”之意。

# re模块操作
在Python中需要通过正则表达式对字符串进行匹配的时候，需要使用re模块。
## match
re.match是⽤来进⾏正则匹配检查的⽅法，若字符串匹配正则表达式，则match⽅法返回匹配对象（Match Object），否则返回None（注意不是空字符串""）。匹配对象Macth Object具有group⽅法，⽤来返回字符串的匹配部分。re.match()能够匹配出以XXX开头的字符串
``` python
# 导入模块
import re

result = re.match(正则表达式， 要匹配的字符串)

使用group方法来提取数据
result.group()
```
## 示例(匹配以hello开头的语句)
``` python
In [2]: result = re.match("hello", "hello world")

In [3]: result.group()
Out[3]: 'hello'
```
# 表示字符
正则表达式的单字符匹配

字符|功能
:----:|----
.|匹配任意一个字符(除了\n)
[]|匹配[]中列举的字符
\d|匹配数字0-9
\D|匹配非数字
\s|匹配空白(空格/tab键)
\S|匹配非空格
\w|匹配单词字符(a-z、 A-Z、 0-9、 _)
\W|匹配费单词字符

# 表示数量
正则表达式的多个字符匹配

字符|功能
:----:|----
*|匹配前一个字符出现0次或者无限次(可有可无)
+|匹配前一个字符出现1次或者无限次(至少又一次)
?|匹配前一个字符出现1次或者0次(要么1次要么没有)
{m}|匹配前一个字符出现m次
{m,}|匹配前一个字符至少出现m次
{m,n}|匹配前一个字符出现m到n次

# 表示边界
字符|功能
:----:|----
^|匹配字符串开头
$|匹配字符串结尾
\b|匹配一个单词的边界
\B|匹配非单词边界

# 原始字符串
与⼤多数编程语⾔相同， 正则表达式⾥使⽤"\"作为转义字符 ，这就可能造成反斜杠困扰。假如你需要匹配⽂本中的字符"\"，那么使⽤编程语⾔表示的正则表达式⾥将需要4个反斜杠"\\"：前两个和后两个分别⽤于在编程语⾔⾥转义成反斜杠，转换成两个反斜杠后再在正则表达式⾥转义成⼀个反斜杠。Python⾥的原⽣字符串很好地解决了这个问题，有了原始字符串，你再也不⽤担⼼是不是漏写了反斜杠，写出来的表达式也更直观。

``` python
In [6]: m = "\\na"
In [7]: result = re.match(r"\\na", m)

In [8]: result.group()
Out[8]: '\\na'

In [9]: print(result.group())
\na
```

# 示例1 匹配手机号码
``` python
In [11]: result = re.match("1\d{10}$", "18888888888")

In [12]: result.group()
Out[12]: '18888888888'
```

# 示例2 匹配163邮箱
``` python
In [14]: result = re.match("\w{4,20}@163\.com$","hello@163.com")

In [15]: result.group()
Out[15]: 'hello@163.com'
```

# 匹配分组
字符|功能
:----:|----
竖线|匹配左右任意一个表达式
(ab)|将括号里中的字符作为一个分组
\num|引用分组num匹配到的字符串
(?P<name>)|分组起别名
(?P=name)|引用起别名为name分组匹配到的字符串

## 匹配0-100之间的数字
``` python
In [21]: result = re.match("0$|[1-9]\d$|100", "0")

In [22]: result.group()
Out[22]: '0'

In [23]: result = re.match("0$|[1-9]\d$|100", "87")

In [25]: result.group()
Out[25]: '87'

In [26]: result = re.match("0$|[1-9]\d$|100", "08")

In [27]: result.group()
-------------------------------------------------------------------------
AttributeError                          Traceback (most recent call last)
<ipython-input-27-c8eb6f1e4981> in <module>()
----> 1 result.group()

AttributeError: 'NoneType' object has no attribute 'group'
```
## ()分组
()分组可以通过group(num)来对对应匹配分组的内容进行提取group(0)表示所有匹配的内容0可以不写group()，大于1后是匹配的对应分组
``` python
In [57]: result = re.match("(\w+) (\d+)", "hello 100")

In [58]: result.group()
Out[58]: 'hello 100'

In [59]: result.group(1)
Out[59]: 'hello'

In [60]: result.group(2)
Out[60]: '100'
```
# re模块的高级用法
## search
查找整个要匹配的字符串，返回第一次匹配成功的内容对象
例:匹配出字符串中的数字

``` python
In [26]: re.search("\d+", "fdaj174315")
Out[26]: <_sre.SRE_Match object; span=(4, 10), match='174315'>
```
## findall
查找整个要匹配的字符串，返回所有匹配的内容,返回一个列表
例:匹配出字符串中的所有数字
``` python
In [30]: result = re.findall("\d+", "hello123world456hi11")
In [31]: result
Out[31]: ['123', '456', '11']
```
## sub
将匹配到的数据进行替换，返回字符串。
``` python
re.sub(正则表达式，替换的内容，匹配的字符串)
```
例：将字符串中的所有数字置0
``` python
In [33]: result = re.sub(r"\d+","0", "python:10, java:80, cpp:90")

In [34]: result
Out[34]: 'python:0, java:0, cpp:0'
```
替换的内容可以为函数
**函数传入内容为匹配到的内容为一个对象，取值的时候需要用，返回的为替换的内容必须为字符串类型**
例：将字符串中的所有数字加5
``` python
In [40]: def add(temp):
    ...:    temp = temp.group()
    ...:    temp = int(temp) + 5
    ...:    return str(temp)
    ...:
    ...:

In [41]: result = re.sub(r"\d+",add, "python:10, java:80, cpp:90")

In [42]: result
Out[42]: 'python:15, java:85, cpp:95'
```
## split
根据匹配进行切割字符串，返回一个列表
```
re.split(需要根据什么切割, 切割的字符串)
```
例：切割字符串"python:java php-cpp"
``` python
In [44]: result = re.split(":| |-","python:java php-cpp")

In [45]: result
Out[45]: ['python', 'java', 'php', 'cpp']
```
# python贪婪和非贪婪
Python⾥数量词默认是贪婪的（在少数语⾔⾥也可能是默认⾮贪婪），总是尝试匹配尽可能多的字符；⾮贪婪则相反，总是尝试匹配尽可能少的字符。在"*","?","+","{m,n}"表示数量后⾯加上？，使贪婪变成⾮贪婪。
例：

``` python
In [49]: result = re.match(".+(\d+-\d+-\d+-\d+)", s)

In [50]: result.group(1)
Out[50]: '4-235-22-423'

In [51]: result = re.match(".+?(\d+-\d+-\d+-\d+)", s)

In [52]: result.group(1)
Out[52]: '234-235-22-423'

```
正则表达式模式中使⽤到通配字，那它在从左到右的顺序求值时，会尽量“抓取”满⾜匹配最⻓字符串，在我们上⾯的例⼦⾥⾯，“.+”会从字符串的启始处抓取满⾜模式的最⻓字符，其中包括我们想得到的第⼀个整型字段的中的⼤
部分，“\d+”只需⼀位字符就可以匹配，所以它匹配了数字“4”，⽽“.+”则匹配了从字符串起始到这个第⼀位数字4之前的所有字符。解决⽅式：⾮贪婪操作符“？”，这个操作符可以⽤在"*","+","?"的后⾯，要求正则匹配的越少越好。

# 示例：
## 从下列字符串中提取文本去除所有html标签
```
<div>
        <p>岗位职责：</p>
<p>完成推荐算法、数据统计、接口、后台等服务器端相关工作</p>
<p><br></p>
<p>必备要求：</p>
<p>良好的自我驱动力和职业素养，工作积极主动、结果导向</p>
<p>&nbsp;<br></p>
<p>技术要求：</p>
<p>1、一年以上 Python 开发经验，掌握面向对象分析和设计，了解设计模式</p>
<p>2、掌握HTTP协议，熟悉MVC、MVVM等概念以及相关WEB开发框架</p>
<p>3、掌握关系数据库开发设计，掌握 SQL，熟练使用 MySQL/PostgreSQL 中的一种<br></p>
<p>4、掌握NoSQL、MQ，熟练使用对应技术解决方案</p>
<p>5、熟悉 Javascript/CSS/HTML5，JQuery、React、Vue.js</p>
<p>&nbsp;<br></p>
<p>加分项：</p>
<p>大数据，数理统计，机器学习，sklearn，高性能，大并发。</p>

        </div>
```

``` python
In [70]: s = """
    ...: <div>^M
    ...:         <p>岗位职责：</p>^M
    ...: <p>完成推荐算法、数据统计、接口、后台等服务器端相关工作</p>^M
    ...: <p><br></p>^M
    ...: <p>必备要求：</p>^M
    ...: <p>良好的自我驱动力和职业素养，工作积极主动、结果导向</p>^M
    ...: <p>&nbsp;<br></p>^M
    ...: <p>技术要求：</p>^M
    ...: <p>1、一年以上 Python 开发经验，掌握面向对象分析和设计，了解设
    ...: 计模式</p>^M
    ...: <p>2、掌握HTTP协议，熟悉MVC、MVVM等概念以及相关WEB开发框架</p>
    ...: ^M
    ...: <p>3、掌握关系数据库开发设计，掌握 SQL，熟练使用 MySQL/PostgreS
    ...: QL 中的一种<br></p>^M
    ...: <p>4、掌握NoSQL、MQ，熟练使用对应技术解决方案</p>^M
    ...: <p>5、熟悉 Javascript/CSS/HTML5，JQuery、React、Vue.js</p>^M
    ...: <p>&nbsp;<br></p>^M
    ...: <p>加分项：</p>^M
    ...: <p>大数据，数理统计，机器学习，sklearn，高性能，大并发。</p>^M
    ...: ^M
    ...:         </div>
```
方法1：
``` python
In [71]: re.sub("<\w+>|</\w+>","", s)
Out[71]: '\n\n        岗位职责：\n完成推荐算法、数据统计、接口、后台等服务器端相关工作\n\n必备要求：\n良好的自我驱动力和职业素养，工作积极主动、结果导向\n&nbsp;\n技术要求：\n1、一年以上 Python 开发经验，掌握面向对象分析和设计， 了解设计模式\n2、掌握HTTP协议，熟悉MVC、MVVM等概念以及相关WEB开发框架\n3、掌握关系数据库开发设计，掌握 SQL，熟练使用 MySQL/PostgreSQL 中的一种\n4、掌握NoSQL、MQ，熟练使用对应技术解决方案\n5、熟悉 Javascript/CSS/HTML5，JQuery、React、Vue.js\n&nbsp;\n加分项：\n大数据，数理统计，机器学习，sklearn，高性能，大并发。\n\n        \n'
```
方法2:
关闭贪婪算法
``` python
In [72]: re.sub("<\w+?>", "",s)
Out[72]: '\n\n        岗位职责：</p>\n完成推荐算法、数据统计、接口、后台等服务器端相关工作</p>\n</p>\n必备要求：</p>\n良好的自我驱动力和职业素养，工作积极主动、结果导向</p>\n&nbsp;</p>\n技术要求：</p>\n1、一年以上 Python 开发经 验，掌握面向对象分析和设计，了解设计模式</p>\n2、掌握HTTP协议，熟悉MVC、MVVM等概念以及相关WEB开发框架</p>\n3、掌握关系数据库开发设计，掌握 SQL，熟练使用 MySQL/PostgreSQL 中的一种</p>\n4、掌握NoSQL、MQ，熟练使用对应技术解决方案</p>\n5、熟悉 Javascript/CSS/HTML5，JQuery、React、Vue.js</p>\n&nbsp;</p>\n加 分项：</p>\n大数据，数理统计，机器学习，sklearn，高性能，大并发。</p>\n\n        </div>\n'
```